<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="shortcut icon" href="../../docs-assets/ico/favicon.png"> -->

    <title>Monte Carlo methods for improved rendering</title>

    <!-- Bootstrap core CSS -->
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/yeti/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
    <script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>

    <style>
      blockquote p.hero {
        font-size: 28px;
        text-align: center;
      }
      img.padded {
        margin: 1em;
      }
      img.smooth {
        border-radius: 0px;
        box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.4);
        margin: 1em;
      }
    </style>
  </head>

  <body>

    <a href="https://github.com/Smerity/montelight-cpp">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
    </a>

    <div class="container">

      <div>
        <img src="img/iacs.jpg" class="pull-right" width="350px" />
        <h2>Monte Carlo methods for improved rendering</h2>
        <h3 class="text-muted">Faster raytracing through importance sampling, rejection sampling, and variance reduction</h3>
      </div>

      <hr />
      <center>
        <img src="img/montage_passes_annotated.png" width="768" height="256"
          style="border-radius: 4px; box-shadow: 1px 1px 5px rgba(0,0,0,0.3);"
        />
      </center>
      <hr />

      <center>
      <div class="btn-toolbar" role="toolbar">
        <a href="code_overview.html" type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-star"></span> Annotated code overview</a>
        <button type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-file"></span> Read paper</button>
        <a href="files/AM207_Poster.pdf" type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-picture"></span> View poster</a>
      </div>
      </center>

      <hr />

      <div class="content">

        <div>
          <h2>Approach</h2>

<p>
To simulate the global reflection of light throughout a scene, we need to consider how light moves around the scene.
This is referred to as the light transport equation, described in \cite{kajiya1986rendering}.
The light transport equation states that the radiance of a point is the sum of the self-emitted radiance (glow) and the reflected radiance.
This value is then distributed according to the material's bidirectional reflectance distribution function (BRDF), which is detailed more in the next section.
Intuitively, the BRDF looks at the angle of the reflected light and the outgoing angle to decide how much light should go in that direction.
If the BRDF states the surface is perfectly mirror like, for example, only very specific angles make a contribution to the reflected radiance.
</p>

<p>
\begin{align}
L_{out}(x, \theta_o) & = L_{emit}(x, \theta_o) + L_{reflected}(x, \theta_o) \\
& = L_e(x, \theta_o) + \int{L_i(x, \theta_i) f_r(x, \theta_i, \theta_o) | \theta_i \cdot N_x | \partial w_i} \\
& = \text{emitted from object} + \text{reflected onto object}
\end{align}
</p>

<p>
The integral for the reflected light is computed over the hemisphere of all possible incoming directions.
As this is impossible to compute exactly, it is approximated using Monte Carlo methods, turning the integral into a finite sum of samples.
The primary issue that can occur is when noise is too strong to give reasonable estimations as to the radiance.
Whilst the expected value remains accurate, the standard deviation (error) decreases by $\frac{1}{\sqrt{n}}$, where $n$ is the number of samples.
To achieve a noise free image requires a large number of samples, especially if the scene is complex.
</p>

<h2>Importance sampling using explicit light sampling</h2>

<p>
In an unbiased Monte Carlo renderer, the light path being sampled must hit a luminaire (light source) before it can make any contribution to the radiance of a given pixel.
When the luminaire is small, the probability that a random light path will intersect with it is highly unlikely, requiring a larger and larger number of light paths to be sampled, most of which contribute nothing to the radiance.
These small but high intensity luminaires are not uncommon in computer graphics, with the most common example being the sun, which although small dominates the light contribution to most scenes.
</p>

<p>
By exploiting our knowledge of the scene, specifically the location of these luminaires, we can perform importance sampling towards the location of the light sources \citep{shirley1996monte}.
To do this, we select a random point on any surface that emits light (luminaire).
We then check whether the given random point is visible from the hit position.
If it isn't, the light source is not visible, resulting in no light contribution.
If the random point is visible, we compute what portion of the light is reflected towards the outgoing light path according to the BRDF function.
</p>

<p>
Selecting a random point is important.
Imagine sampling from a sphere.
If a single point was used, such as the center, all shadows generated by that luminaire would be perfect hard projections of the shapes.
If multiple points are used, evenly distributed over the sphere, the shadows would have a penumbra (partially shaded outer region of a cast shadow) related in size to the sphere.
Taken over an infinite number of samples, and assuming that the selected point from the luminaire was generated truly at random, each of the points on the luminaire would be sampled evenly.
</p>

<p>
Adding explicit light sampling does change the way in which the light transport equation must work however.
On the first bounce of the light path where the path is directly from the image plane to the scene ($depth = 0$), the light transport equation is:

$$L_o(x, \theta_o) = \text{emitted from object} + \text{light from luminaires} + \text{reflected onto object}$$

For all subsequent steps ($depth > 0$), the light transport equation drops the first term:

$$L_o(x, \theta_o) = \text{light from luminaires} + \text{reflected onto object}$$

This is required as otherwise double counting would occur.
</p>

<h3>Impact of explicit light sampling</h3>

<p>
In the two animated images below, we can see the impact that explicit light sampling has on rendering.
The animated image that does not use explicit light sampling begins almost completely black, adding speckled light over time.
This is as the majority of light paths never end up at the small light source.
If the light path does not hit a light source, it never contributes any information to the scene.
</p>
<p>
The animated image with explicit light sampling is comparitively boring.
Even at the very start, the majority of the scene is well defined.
Whilst it does have noise, the noise is close to the eventual value rather than being black, as in the previous image.
</p>
<p>
The most important thing to realize is that the image on the left shows one frame per 50 samples, whilst the image on the right uses one frame per sample.
As such, the image on the left is shown at approximately ten times real rendering speed whilst the image on the right is near real time.
</p>

<center>
<img src="img/no_emitter_2500.gif" width="256" height="256">
<img src="img/emitter_50.gif" width="256" height="256">
<p>
<em>
The image on the left uses 2,500 samples per pixel, no explicit light sampling, and takes 10 minutes to render.<br />
The image on the right uses only 50 samples but performs importance sampling using explicit light sampling, and renders in 10 seconds.
</em>
</p>
</center>

<hr />

<center>
<img src="img/fov.png" width="512" />
<div id="carousel-example-generic" class="carousel slide" data-ride="carousel" style="width: 512px">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
    <li data-target="#carousel-example-generic" data-slide-to="2"></li>
    <li data-target="#carousel-example-generic" data-slide-to="3"></li>
    <li data-target="#carousel-example-generic" data-slide-to="4"></li>
  </ol>

  <!-- Wrapper for slides -->
  <div class="carousel-inner">
    <div class="item active">
      <img src="img/dof/0.png">
    </div>
    <div class="item">
      <img src="img/dof/1.png">
    </div>
    <div class="item">
      <img src="img/dof/2.png">
    </div>
    <div class="item">
      <img src="img/dof/3.png">
    </div>
    <div class="item">
      <img src="img/dof/4.png">
    </div>
  </div>

  <!-- Controls -->
  <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
  </a>
  <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
  </a>
</div>
</center>

<hr />

<center>
<img src="img/dofb.png" width="512" />
</center>

<hr />

        </div>

        <div class="footer">
          <p>T. Brennan, S. Merity, T. Wilson 2014</p>
        </div>

      </div>

    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
  </body>
</html>
