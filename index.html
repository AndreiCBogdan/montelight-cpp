<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="shortcut icon" href="../../docs-assets/ico/favicon.png"> -->

    <title>Monte Carlo methods for improved rendering</title>

    <!-- Bootstrap core CSS -->
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/yeti/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
    <script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>

    <style>
      blockquote p.hero {
        font-size: 28px;
        text-align: center;
      }
      img.padded {
        margin: 1em;
      }
      img.smooth {
        border-radius: 0px;
        box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.4);
        margin: 1em;
      }
    </style>
  </head>

  <body>

    <a href="https://github.com/Smerity/montelight-cpp">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
    </a>

    <div class="container">

      <div>
        <img src="img/iacs.jpg" class="pull-right" width="350px" />
        <h2>Monte Carlo methods for improved rendering</h2>
        <h3 class="text-muted">Faster raytracing through importance sampling, rejection sampling, and variance reduction</h3>
      </div>

      <hr />
      <center>
        <img src="img/montage_passes_annotated.png" width="768" height="256"
          style="border-radius: 4px; box-shadow: 1px 1px 5px rgba(0,0,0,0.3);"
        />
      </center>
      <hr />

      <center>
      <div class="btn-toolbar" role="toolbar">
        <a href="code_overview.html" type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-star"></span> Annotated code overview</a>
        <a href="files/AM207_Paper.pdf" type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-file"></span> Read paper</a>
        <a href="files/AM207_Poster.pdf" type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-picture"></span> View poster</a>
      </div>
      </center>

      <hr />

      <div class="content">

        <div>

          <h2>Overview</h2>

          <p>
          Stochastic ray tracing is one of the fundamental algorithms in computer graphics for generating photo-realistic images.
          We implement an unbiased Monte Carlo renderer as an experimental testbed for evaluating improved sampling strategies.
          Our results show that the improved sampling methods we use for rendering can give comparable image quality over <b><span style="color:#3A3;">twenty times faster</span></b> than naive Monte Carlo methods.
          </p>

          <hr />

          <h2>Approach</h2>

<p>
To simulate the global reflection of light throughout a scene, we need to consider how light moves around the scene.
This is referred to as the light transport equation, described in <a href="http://www.cse.chalmers.se/edu/year/2011/course/TDA361/2007/rend_eq.pdf">Kajiya (1986)</a>.
The basic idea is light is either produced by the object (emission) or reflected onto it from other objects (reflected).
For full details, refer to our paper.
</p>

<p>
\begin{align}
L_{out}(x, \theta_o) & = L_{emit}(x, \theta_o) + L_{reflected}(x, \theta_o) \\
& = L_e(x, \theta_o) + \int{L_i(x, \theta_i) f_r(x, \theta_i, \theta_o) | \theta_i \cdot N_x | \partial w_i} \\
& = \text{emitted from object} + \text{reflected onto object}
\end{align}
</p>

<p>
The integral for the reflected light is computed over the hemisphere of all possible incoming directions.
As this is impossible to compute exactly, it is approximated using Monte Carlo methods.
The primary issue that can occur is when noise is too strong to give reasonable estimations as to the radiance.
Whilst the expected value remains accurate, the standard deviation (error) decreases by $\frac{1}{\sqrt{n}}$, where $n$ is the number of samples.
To achieve a noise free image requires a large number of samples, especially if the scene is complex.
</p>

<h2>Importance sampling using BRDF sampling</h2>

<p>
Some materials only allow light in very specific directions.
This is commonly related to the roughness of the material.
A mirror, such as the one on the left, needs far less samples than the diffuse surface on the right.
</p>

<p>
<center>
  <img src="img/roughness.png" />
</center>
</p>

<p>
This is dictated by the material's Bidirectional Reflectance Distribution Function (BRDF).
This distribution function dictates how much light ends up reflected in a given direction.
By sampling directions to test directly from this distribution function (importance sampling), we can avoid taking samples that contribute little to the final image.
</p>

<p>
<center>
  <img src="img/brdf_montage.png" />
  <p><em>Uniform sampling of the potential bounce directions (blue) versus BRDF sampling (orange).</em></p>
</center>
</p>

<h2>Importance sampling using explicit light sampling</h2>

<p>
In an unbiased Monte Carlo renderer, the light path being sampled must hit a light source (luminaire) before it can make any contribution to the radiance of a given pixel.
When the luminaire is small, the probability that a random light path will intersect with it is highly unlikely, requiring a larger and larger number of light paths to be sampled.
By exploiting our knowledge of the scene, specifically the location of these light sources, we can perform importance sampling towards their locations.
By sampling towards the light and checking if any other objects intervene (a "shadow ray"), we don't need to wait for chance to point us to our strongest light contribution in the scene.
</p>

<center><img src="img/raytracing_diagram.png" height="250px" /></center>

<p>
In the two animated images below, we can see the impact that explicit light sampling has on rendering.
The animated image that does not use explicit light sampling begins almost completely black, adding speckled light over time.
This is as the majority of light paths never end up at the small light source.
</p>
<p>
The animated image with explicit light sampling is comparitively boring.
Even at the very start, the majority of the scene is well defined.
Whilst it does have noise, the noise is close to the eventual value rather than being black, as in the previous image.
</p>
<p>
The most important thing to realize is that the image on the left shows one frame per 50 samples, whilst the image on the right uses one frame per sample.
As such, the image on the left is shown at approximately ten times real rendering speed whilst the image on the right is near real time.
</p>

<center>
<img src="img/no_emitter_2500.gif" width="256" height="256">
<img src="img/emitter_50.gif" width="256" height="256">
<p>
<em>
The image on the left uses 2,500 samples per pixel, no explicit light sampling, and takes 10 minutes to render.<br />
The image on the right uses only 50 samples but performs importance sampling using explicit light sampling, and renders in 10 seconds.
</em>
</p>
</center>

<h2>Rejection sampling via Russian roulette path termination</h2>

<p>
Bright photons in real life may bounce millions of times, but computing such a long path is intensive and contributes little to the final result.
Stopping after a Ô¨Ånite number of bounces can result in significant bias however.
</p>
<p>
Instead, we introduce <em>Russian roulette path termination</em>, where at each bounce we terminate the light path with probability $q$.
This probability is selected proportional to the overall reflective properties of the material.
This means bright objects encourage more bounces whilst dark objects encourage less.
As dark objects absorb more light, this means that terminating the path early is unlikely to increase the noise in the image.
</p>

<center>
<img src="img/russian_montage.png" \>
<p>
<em>
  The first three images have a maximum allowed light path length of 1, 2, and 3, taking 18 seconds, 31 seconds and 58 seconds respectively.<br />
The image on the right uses Russian roulette path termination, taking 83 seconds.
</em>
</p>
</center>

<p>
Whilst in our scene, extreme bias can primarily be seen in images of maximum allowed light path length of 1 and 2,
extreme bias can still be visible in more complex scenes even with max depths of 10 or more.
</p>

<h2>Simulating physical phenomena</h2>

<p>
Monte Carlo methods allow easy emulation of physical phenomena such as camera lenses, including aperture size and focal length.
This can be extended to other physical phenomena including motion blur, which is simply performing Monte Carlo sampling over time as well.
</p>

<center>
<img src="img/fov.png" width="512" />
<div id="carousel-example-generic" class="carousel slide" data-ride="carousel" style="width: 512px">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
    <li data-target="#carousel-example-generic" data-slide-to="2"></li>
    <li data-target="#carousel-example-generic" data-slide-to="3"></li>
    <li data-target="#carousel-example-generic" data-slide-to="4"></li>
  </ol>

  <!-- Wrapper for slides -->
  <div class="carousel-inner">
    <div class="item active">
      <img src="img/dof/0.png">
    </div>
    <div class="item">
      <img src="img/dof/1.png">
    </div>
    <div class="item">
      <img src="img/dof/2.png">
    </div>
    <div class="item">
      <img src="img/dof/3.png">
    </div>
    <div class="item">
      <img src="img/dof/4.png">
    </div>
  </div>

  <!-- Controls -->
  <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
  </a>
  <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
  </a>
</div>
<p>
<em>
Impact of various focal lengths on the resulting image.<br />
Note how the first few are "flat" whilst the latter ones appear stretched.
</em>
</p>
</center>

<p>
When we modify aperture size and focal length, we also modify how the camera samples pixels from the shot.
For each pixel in our image, samples are taken over multiple rays, each sent at slightly different angles, all converging at the focal length.
By using Monte Carlo sampling, we approximate sampling over all possible rays, resulting in a physically accurate blur in the foreground and background.
</p>

<center>
<img src="img/dofb.png" width="512" />
<p>
<em>
  Exaggerated depth of field to emphasise the accurate blur produced by Monte Carlo sampling.<br />
  This can be combined with variance reduction such that more samples are taken in the less defined, blurrier parts of the image.
</em>
</p>
</center>

<hr />

        </div>

        <div class="footer">
          <p>T. Brennan, S. Merity, T. Wilson 2014</p>
        </div>

      </div>

    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
  </body>
</html>
